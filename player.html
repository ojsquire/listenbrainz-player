<!DOCTYPE html>
<html>
<body>

<audio controls id="player">
  <source src="tst.mp3">
</audio>

<script>
  // Getting metadata from file should be next, 
  // as don't wanna have to wait so long to test each part
  var player = document.getElementById("player");
  player.addEventListener("play", function () {
    var xhr = new XMLHttpRequest();
    var url = 'https://api.listenbrainz.org/1/submit-listens'
    var payload = JSON.stringify(
      {
        "listen_type": "single",
        "payload": [
          {
		  // Math.floor(Date.now() / 1000)
            "listened_at": Math.floor(Date.now() / 1000),
            "track_metadata": {
              "additional_info": {
                "release_mbid": "47643ba6-0af3-41af-824b-e324d3a6676d",
                "artist_mbids": [
                  "87225a21-c925-41cd-852f-be4b052d0824"
                ],
                "recording_mbid": "d0ceeb40-eec0-40db-a033-0a88941951af"
              },
              "artist_name": "AFX",
              "track_name": "[untitled]",
              "release_name": "Analogue Bubblebath 5"
            }
          }
        ]
      }
    )
    xhr.open('POST', url, true);
    xhr.setRequestHeader('Content-type', 'application/json');
    xhr.setRequestHeader('Authorization', 'OAuth ' + 'MY-KEY');
    xhr.onload = function () {
      // do something to response
      alert(xhr.responseText);
    };
    xhr.send(payload);
  }
);
</script>

</body>
</html>
